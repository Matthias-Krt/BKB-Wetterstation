<html>
    
    <head>
        <title>Wetterstation Dashboard</title>
        
        <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
        
        <link rel="stylesheet" href="css/style.css">
        <link rel="stylesheet" href="css/dashboard.css">
        
        <link href="https://fonts.googleapis.com/css2?family=Open+Sans:ital,wght@0,400;0,600;0,700;0,800;1,400&display=swap" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
        
        <script src="https://code.jquery.com/jquery-1.10.2.js"></script>
        <script src="js/sensebox.js"></script>
    </head>
    
    <body>
        
        <div id="header-placeholder"><!--PLACEHOLDER--></div>
        
        <div id="slider"><!--PLACEHOLDER--></div>
        
        <div id="data"><!--PLACEHOLDER--></div>
        
        <script>
            $("#header-placeholder").load("/common/header.html");
        </script>
        
        <script>            
            var sliderNum = 0;
            var sliderSpeed = 3000;
            var dataUpdateInterval = 3000;
            
            function setSenseBoxData() {
                getSenseBoxData().done(function(result) {  
                    $("#data").html("");
                    for(var i = 0; i < result.sensors.length; i++) {
                        var title = result.sensors[i].title;
                        var lastMeasurement = result.sensors[i].lastMeasurement.value;
                        var unit = result.sensors[i].unit;

                        $("#data").append("<div><h1>" + lastMeasurement + unit + "</h1><h2>" + title + "</h2></div>");
                    }

                }).fail(function() {
                    //TODO: Error Handling
                   console.log("getSenseBoxData failed"); 
                });
            }
            function setSenseBoxSlider() {
                getSenseBoxData().done(function(result) {                        
                    $("#slider").html("<h1>" + result.sensors[sliderNum].lastMeasurement.value + result.sensors[sliderNum].unit + "</h1><h2>" + result.sensors[sliderNum].title + "</h2>");

                    if(sliderNum < result.sensors.length-1) {
                        sliderNum++;
                    } else {
                        sliderNum = 0;
                    }
                }).fail(function() {
                    //TODO: Error Handling
                    console.log("getSenseBoxData failed");
                });
            }
            
            $(document).ready(function() {
                
                setSenseBoxSlider();
                setSenseBoxData();
                
                /* ### SenseBox ### */
                //Slider
                setInterval(function() { setSenseBoxSlider(); }, sliderSpeed);
                //Data-Blocks
                setInterval(function() { setSenseBoxData(); }, dataUpdateInterval);
            });
        </script>
        
    </body>
    
</html>